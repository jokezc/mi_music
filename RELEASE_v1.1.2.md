# 风花雪乐 v1.1.2 发布说明

**发布日期**: 2026-01-31

## 概述

v1.1.2 在 v1.1.1 基础上，主要增强了权限与设置体验、播放状态同步，并做了音乐库与路由相关的小幅优化与修复。

## 新增功能

- **启动时权限请求**：应用首次启动时会主动请求通知、网络等必要权限，减少使用过程中突然弹窗，提升首次使用体验。
- **设置页直达**：支持通过路由参数（如 `?section=xxx`）直接打开设置页的某个区块，便于从其他页面跳转到指定设置项。
- **连接一致性提示**：登录或连接成功后，若当前设置的 host/port 与已连接的不一致，会提示用户，避免混淆。

## 改进与优化

- **播放状态同步**：强制在更新时刷新 MediaItem，确保锁屏/状态栏/控制中心的播放信息与当前歌曲一致，避免“切歌后仍显示上一首”的问题。
- **音乐库精简**：移除未使用的「全部歌曲」相关逻辑与依赖，简化音乐库页面代码结构。
- **iOS 网络权限**：优化访问局域网设备时的网络权限请求逻辑，确保在需要时能正确触发系统权限弹窗。

## 修复

- **播放状态不刷新**：修复因 MediaItem 内容未变化而导致状态栏、控制中心不更新的问题。

## 与 v1.1.1 的差异摘要

| 类型     | 说明 |
|----------|------|
| 新增     | 初始权限请求、设置路由参数、连接 host/port 校验提示 |
| 改进     | 音频 MediaItem 强制更新、音乐库代码精简、iOS 权限逻辑 |
| 修复     | 播放状态与状态栏/控制中心不同步 |

## 升级建议

- 从 v1.1.1 升级：直接安装新版本即可，无数据迁移。
- 若曾遇到「切歌后状态栏/控制中心不更新」或「首次使用权限弹窗时机不佳」，建议升级到本版本。

---

完整历史更新见 [CHANGELOG.md](CHANGELOG.md)。
